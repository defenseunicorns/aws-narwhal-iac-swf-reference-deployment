includes:
  - deploy: ./tasks/deploy.yaml
  - swf: ./tasks/swf.yaml

tasks:
  - name: terraform-one-time-bootstrap-per-env
    actions:
      - description: |
          One time bootstrapping of a terraform environment for both the bootstrap and swf modules using the bootstrap root module
          This sets up the backend resources in AWS and templates out the backend.tf file in each root module and generates the ${root_module}-backend.tfconfig files in the ./iac/env/${env}/backends directory.
        task: deploy:terraform-one-time-bootstrap-per-env
        with:
          env: ${ENV}

  - name: terraform-init-aws-bootstrap
    actions:
      - description: "terraform init AWS SWF IaC Bootstrap module"
        task: deploy:terraform-init
        with:
          root_module: bootstrap

  - name: terraform-plan-aws-bootstrap
    actions:
      - description: "Terraform plan AWS SWF IaC Bootstrap module"
        task: deploy:terraform-plan
        with:
          env: ${ENV}
          root_module: bootstrap

  - name: terraform-apply-aws-bootstrap
    actions:
      - description: "Terraform apply AWS SWF IaC Bootstrap module"
        task: deploy:terraform-apply
        with:
          env: ${ENV}
          root_module: bootstrap

  - name: terraform-init-aws-swf
    actions:
      - description: "AWS SWF IaC"
        task: deploy:terraform-init
        with:
          root_module: swf

  - name: terraform-plan-aws-swf
    actions:
      - description: "AWS SWF IaC"
        task: deploy:terraform-plan
        with:
          env: ${ENV}
          root_module: swf

  - name: terraform-apply-aws-swf
    actions:
      - description: "Apply AWS SWF IaC"
        task: deploy:terraform-apply
        with:
          env: ${ENV}
          root_module: swf
      - description: "Move uds-config.yaml"
        task: swf:uds-config

  - name: zarf-create
    actions:
      - description: "Create the zarf package"
        task: swf:zarf-create

  - name: zarf-deploy
    actions:
      - description: "Deploy the zarf package"
        task: swf:zarf-deploy

  - name: zarf-publish
    actions:
      - description: "Publish the zarf package"
        task: swf:zarf-publish

  - name: bundle-create
    actions:
      - description: "Create the swf bundle"
        task: swf:bundle-create

  - name: bundle-deploy
    actions:
      - description: "Deploy the swf bundle"
        task: swf:bundle-deploy

  - name: bundle-publish
    actions:
      - description: "Publish the swf bundle"
        task: swf:bundle-publish
