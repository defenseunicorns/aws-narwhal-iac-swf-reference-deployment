kind: UDSBundle
metadata:
  name: swf
  description: A UDS bundle for deploying a swf to narwhal reference deployment
  version: "0.1.0"

packages:
  - name: zarf-init-s3-backend
    repository: ghcr.io/defenseunicorns/zacks-zarf-funhouse/init
    ref: v0.32.2

  - name: storageclass
    repository: ghcr.io/defenseunicorns/packages/narwhal-delivery-zarf-package-eks-addons/storageclass
    ref: 0.0.1
    optionalComponents:
      - fetch-staged-aws-ssm-vars

  - name: aws-load-balancer-controller
    repository: ghcr.io/defenseunicorns/packages/narwhal-delivery-zarf-package-eks-addons/aws-load-balancer-controller
    ref: 0.0.1
    optionalComponents:
      - fetch-staged-aws-ssm-vars

  - name: core
    repository: ghcr.io/defenseunicorns/packages/uds/core
    ref: 0.13.1-registry1
    overrides:
      neuvector:
        core:
          values:
            - path: k3s.enabled
              value: false
            - path: containerd.enabled
              value: true
            - path: containerd.path
              value: /run/containerd/containerd.sock
      istio-admin-gateway:
        gateway:
          values:
            - path: service.annotations
              value:
                service.beta.kubernetes.io/aws-load-balancer-type: "external"
                service.beta.kubernetes.io/aws-load-balancer-scheme: "internal"
                service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: "ip"
                service.beta.kubernetes.io/aws-load-balancer-attributes: "load_balancing.cross_zone.enabled=true"
      istio-tenant-gateway:
        gateway:
          values:
            - path: service.annotations
              value:
                service.beta.kubernetes.io/aws-load-balancer-type: "external"
                service.beta.kubernetes.io/aws-load-balancer-scheme: "internal"
                service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: "ip"
                service.beta.kubernetes.io/aws-load-balancer-attributes: "load_balancing.cross_zone.enabled=true"
      istio-passthrough-gateway:
        gateway:
          values:
            - path: service.annotations
              value:
                service.beta.kubernetes.io/aws-load-balancer-type: "external"
                service.beta.kubernetes.io/aws-load-balancer-scheme: "internal"
                service.beta.kubernetes.io/aws-load-balancer-nlb-target-type: "ip"
                service.beta.kubernetes.io/aws-load-balancer-attributes: "load_balancing.cross_zone.enabled=true"

  - name: cluster-autoscaler
    repository: ghcr.io/defenseunicorns/packages/narwhal-delivery-zarf-package-eks-addons/cluster-autoscaler
    ref: 0.0.1-registry1
    optionalComponents:
      - fetch-staged-aws-ssm-vars

  - name: aws-node-termination-handler
    repository: ghcr.io/defenseunicorns/packages/narwhal-delivery-zarf-package-eks-addons/aws-node-termination-handler
    ref: 0.0.1-registry1
    optionalComponents:
      - fetch-staged-aws-ssm-vars

  - name: swf-deps-aws
    path: ../../
    ref: "0.1.0"

  - name: gitlab
    repository: ghcr.io/defenseunicorns/packages/uds/gitlab
    ref: 16.8.1-uds.4-registry1
    overrides:
      gitlab:
        gitlab:
          variables:
            - name: REGISTRY_ROLE_ARN
              description: "The ARN of the role to assume for the registry pods"
              path: registry.serpowceAccount.annotations.eks\.amazonaws\.com/role-arn
            - name: SIDEKIQ_ROLE_ARN
              description: "The ARN of the role to assume for the sidekiq pods"
              path: gitlab.sidekiq.serviceAccount.annotations.eks\.amazonaws\.com/role-arn
            - name: WEBSERVICE_ROLE_ARN
              description: "The ARN of the role to assume for the web service pods"
              path: gitlab.webservice.serviceAccount.annotations.eks\.amazonaws\.com/role-arn
            - name: TOOLBOX_ROLE_ARN
              description: "The ARN of the role to assume for the toolbox pods"
              path: gitlab.toolbox.serviceAccount.annotations.eks\.amazonaws\.com/role-arn

  - name: gitlab-runner
    repository: ghcr.io/defenseunicorns/packages/uds/gitlab-runner
    ref: 16.8.0-uds.0-registry1

  # - name: jenkins
  #   repository: ghcr.io/defenseunicorns/packages/uds/jenkins
  #   ref: 4.12.0-uds.0

  # - name: jira
  #   repository: ghcr.io/defenseunicorns/packages/uds/jira
  #   ref: 1.17.0-uds.1-registry1

  # - name: confluence
  #   repository: ghcr.io/defenseunicorns/packages/uds/confluence
  #   ref: 1.17.0-uds.1-registry1
